# Generated by Anaconda 40.22.3.26
# version=RHEL10
# Use text install
text 

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Disable SELinux & Firewalld
selinux --disabled
firewall --disabled

# Network information
network  --bootproto=dhcp --device=ens160 --ipv6=auto --activate
network  --hostname=lab-base

# Tell Anaconda to fetch packages from network repos (no full DVD needed)
url --url="https://download.rockylinux.org/pub/rocky/10/BaseOS/aarch64/os/"
repo --name="appstream" --baseurl="https://download.rockylinux.org/pub/rocky/10/AppStream/aarch64/os/"

%packages
@^minimal-environment
open-vm-tools
%end

%post --interpreter /bin/bash --log=/mnt/root/ks-post.log

# Create vagrant user with password and sudo access
useradd -m -G wheel vagrant
echo "vagrant:vagrant" | chpasswd

# Set up passwordless sudo
echo "vagrant ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/vagrant
chmod 0440 /etc/sudoers.d/vagrant

systemctl enable --now vmtoolsd

# Enable and start SSH service on first boot
systemctl enable --now sshd

systemctl restart NetworkManager

%end

ignoredisk --only-use=nvme0n1
clearpart --all --initlabel

# Boot partitions
part /boot --fstype="xfs" --ondisk=nvme0n1 --size=600
part /boot/efi --fstype="efi" --ondisk=nvme0n1 --size=300 --fsoptions="umask=0077,shortname=winnt"

# Physical volume covering the entire disk
part pv.01 --fstype="lvmpv" --ondisk=nvme0n1 --grow --size=1

# Volume group 
volgroup rl_lab --pesize=4096 pv.01

# Logical volumes
logvol /opt --fstype="xfs" --size=1024 --name=opt --vgname=rl_lab
logvol /var --fstype="xfs" --size=1024 --name=var --vgname=rl_lab
logvol swap --name=swap --vgname=rl_lab --fstype="swap" --size=1024
#logvol / --fstype="xfs" --size=5120 --grow --name=root --vgname=rl_lab
logvol / --fstype="xfs" --name=root --vgname=rl_lab --size=1 --grow

# System timezone
timezone America/Chicago --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$3xrX1kn8Ejul2gfkjCf4qsA2$niqhOpdcedAOWkonmZ67MXDt5jV9PbmQn5fXOEPWhb/

firstboot --disable
eula --agreed
reboot
